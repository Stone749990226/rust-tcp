运行
```shell
./run.sh
```

可通过命令（nc， Netcat）尝试与目标主机 ​192.168.0.2​ 的 ​端口 666（随便选） 建立 TCP 连接。
```shell
nc 192.168.0.2 666
```

可通过tshark抓包，-i 参数指定要监听的网络接口​
```shell
sudo tshark -i tun0
```

```md

                              +---------+ ---------\      active OPEN  
                              |  CLOSED |            \    -----------  
                              +---------+<---------\   \   create TCB  
                                |     ^              \   \  snd SYN    
                   passive OPEN |     |   CLOSE        \   \           
                   ------------ |     | ----------       \   \         
                    create TCB  |     | delete TCB         \   \       
                                V     |                      \   \     
                              +---------+            CLOSE    |    \   
                              |  LISTEN |          ---------- |     |  
                              +---------+          delete TCB |     |  
                   rcv SYN      |     |     SEND              |     |  
                  -----------   |     |    -------            |     V  
 +---------+      snd SYN,ACK  /       \   snd SYN          +---------+
 |         |<-----------------           ------------------>|         |
 |   SYN   |                    rcv SYN                     |   SYN   |
 |   RCVD  |<-----------------------------------------------|   SENT  |
 |         |                    snd ACK                     |         |
 |         |------------------           -------------------|         |
 +---------+   rcv ACK of SYN  \       /  rcv SYN,ACK       +---------+
   |           --------------   |     |   -----------                  
   |                  x         |     |     snd ACK                    
   |                            V     V                                
   |  CLOSE                   +---------+                              
   | -------                  |  ESTAB  |                              
   | snd FIN                  +---------+                              
   |                   CLOSE    |     |    rcv FIN                     
   V                  -------   |     |    -------                     
 +---------+          snd FIN  /       \   snd ACK          +---------+
 |  FIN    |<-----------------           ------------------>|  CLOSE  |
 | WAIT-1  |------------------                              |   WAIT  |
 +---------+          rcv FIN  \                            +---------+
   | rcv ACK of FIN   -------   |                            CLOSE  |  
   | --------------   snd ACK   |                           ------- |  
   V        x                   V                           snd FIN V  
 +---------+                  +---------+                   +---------+
 |FINWAIT-2|                  | CLOSING |                   | LAST-ACK|
 +---------+                  +---------+                   +---------+
   |                rcv ACK of FIN |                 rcv ACK of FIN |  
   |  rcv FIN       -------------- |    Timeout=2MSL -------------- |  
   |  -------              x       V    ------------        x       V  
    \ snd ACK                 +---------+delete TCB         +---------+
     ------------------------>|TIME WAIT|------------------>| CLOSED  |
                              +---------+                   +---------+

                      TCP Connection State Diagram

```

```md
TCP Header Format
                                  
  0                   1                   2                   3   
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |          Source Port          |       Destination Port        |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        Sequence Number                        |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                    Acknowledgment Number                      |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |  Data |           |U|A|P|R|S|F|                               |
 | Offset| Reserved  |R|C|S|S|Y|I|            Window             |
 |       |           |G|K|H|T|N|N|                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |           Checksum            |         Urgent Pointer        |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                    Options                    |    Padding    |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                             data                              |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```


---

### **TCP 头部字段详解（20字节标准头部）**

| **字段名**               | **位数** | **作用**                                                                 | **常见值/备注**                                                                 |
|--------------------------|----------|--------------------------------------------------------------------------|--------------------------------------------------------------------------------|
| **Source Port**          | 16 bits  | 源端口号                                                                 | 范围：`0`-`65535`（`0`-`1023` 为系统保留端口）                                 |
| **Destination Port**     | 16 bits  | 目标端口号                                                               | 如 HTTP=80，HTTPS=443                                                          |
| **Sequence Number**      | 32 bits  | 序列号                                                                   | 当前数据段的第一个字节的编号（用于数据排序）                                    |
| **Acknowledgment Number**| 32 bits  | 确认号                                                                   | 期望收到的下一个字节的序列号（ACK 标志为 `1` 时有效）                           |
| **Data Offset**          | 4 bits   | TCP 头部长度（以 **4字节** 为单位）                                      | 最小 `5`（20 字节），最大 `15`（60 字节，含选项）                              |
| **Reserved**             | 3 bits   | 保留字段                                                                 | 必须设为 `0`                                                                   |
| **Flags（控制位）**      | 9 bits   | 连接控制标志                                                             | **重要标志**：<br>- `URG`：紧急指针有效<br>- `ACK`：确认号有效<br>- `PSH`：推送数据（立即处理）<br>- `RST`：重置连接<br>- `SYN`：同步序列号（建立连接）<br>- `FIN`：终止连接 |
| **Window Size**          | 16 bits  | 接收窗口大小                                                             | 表示接收方可接收的字节数（流量控制）                                            |
| **Checksum**             | 16 bits  | 校验和（覆盖头部、数据和伪头部）                                         | 用于检测传输错误                                                                |
| **Urgent Pointer**       | 16 bits  | 紧急指针                                                                 | 仅当 `URG=1` 时有效，指示紧急数据的末尾偏移（相对于序列号）                     |
| **Options**              | 可变      | 扩展选项（可选）                                                         | 常见选项：<br>- `MSS`（最大段大小）<br>- `Window Scaling`（窗口缩放因子）<br>- `SACK`（选择性确认） |
| **Padding**              | 可变      | 填充选项字段至 4 字节倍数                                                | 用 `0` 填充                                                                    |
| **Data**                 | 可变      | 应用层数据                                                               | 实际传输的数据内容                                                              |

---

```md
IP header

 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  |Type of Service|          Total Length         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identification        |Flags|      Fragment Offset    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Time to Live |    Protocol   |         Header Checksum       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Source Address                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Destination Address                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options                    |    Padding    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```
当然！以下是 **IPv4 头部字段** 的表格形式总结，更直观易读：

---

### **IPv4 头部字段详解（20字节标准头部）**

| **字段名**            | **位数** | **作用**                                                                 | **常见值/备注**                                                                 |
|-----------------------|----------|--------------------------------------------------------------------------|--------------------------------------------------------------------------------|
| **Version**           | 4 bits   | IP 协议版本                                                              | `4`（IPv4），`6`（IPv6）                                                       |
| **IHL**               | 4 bits   | 头部长度（以 4 字节为单位）                                              | 最小 `5`（20 字节），最大 `15`（60 字节）                                      |
| **Type of Service**   | 8 bits   | 服务质量（QoS）控制                                                     | 现代网络用 **DSCP（6 bits）** + **ECN（2 bits）**                              |
| **Total Length**      | 16 bits  | 整个 IP 数据报的总长度（头部+数据）                                      | 最大 `65535` 字节（受 MTU 限制）                                               |
| **Identification**    | 16 bits  | 数据报唯一标识                                                           | 用于分片重组，同一数据报的分片标识相同                                         |
| **Flags**             | 3 bits   | 分片控制标志                                                             | - `DF（Don't Fragment）`: `1`=禁止分片<br>- `MF（More Fragments）`: `1`=还有后续分片 |
| **Fragment Offset**   | 13 bits  | 分片在原始数据报中的偏移量（以 8 字节为单位）                            | 例如：`100` 表示偏移 `800` 字节                                                |
| **Time to Live (TTL)**| 8 bits   | 生存时间（防环路）                                                       | 每经过路由器减 `1`，常见初始值：`64`（Linux）或 `128`（Windows）               |
| **Protocol**          | 8 bits   | 上层协议类型                                                             | `1`=ICMP，`6`=TCP，`17`=UDP（[完整列表](https://www.iana.org/assignments/protocol-numbers)） |
| **Header Checksum**   | 16 bits  | 头部校验和（仅校验头部）                                                 | 计算方法：16 位取反求和，再取反                                                 |
| **Source Address**    | 32 bits  | 源 IP 地址                                                               | 如 `192.168.1.1`                                                               |
| **Destination Address**| 32 bits | 目的 IP 地址                                                             | 如 `8.8.8.8`                                                                   |
| **Options**           | 可变      | 扩展功能（可选）                                                         | 如记录路由、时间戳，长度需为 4 字节的倍数                                      |
| **Padding**           | 可变      | 填充选项字段至 4 字节倍数                                                | 用 `0` 填充                                                                    |

---

